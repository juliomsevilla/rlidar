<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 R y LiDAR | Tratamiento de datos LiDAR forestales mediante R</title>
  <meta name="description" content="En este libro haremos una introducción al tratamiento de datos LiDAR forestales mediante R" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3 R y LiDAR | Tratamiento de datos LiDAR forestales mediante R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="En este libro haremos una introducción al tratamiento de datos LiDAR forestales mediante R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 R y LiDAR | Tratamiento de datos LiDAR forestales mediante R" />
  
  <meta name="twitter:description" content="En este libro haremos una introducción al tratamiento de datos LiDAR forestales mediante R" />
  

<meta name="author" content="Julio M. Sevilla" />


<meta name="date" content="2021-11-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="introducción-al-lenguaje-r.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introducción</a></li>
<li class="chapter" data-level="1" data-path="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html"><a href="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html"><i class="fa fa-check"></i><b>1</b> La tecnología LIDAR y su aplicación al medio forestal</a>
<ul>
<li class="chapter" data-level="1.1" data-path="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html"><a href="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html#la-teledetección-y-la-tecnología-lidar"><i class="fa fa-check"></i><b>1.1</b> La teledetección y la tecnología LiDAR</a></li>
<li class="chapter" data-level="1.2" data-path="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html"><a href="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html#tipos-de-lidar"><i class="fa fa-check"></i><b>1.2</b> Tipos de LiDAR</a></li>
<li class="chapter" data-level="1.3" data-path="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html"><a href="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html#componentes-de-un-sistema-lidar-aerotransportado"><i class="fa fa-check"></i><b>1.3</b> Componentes de un sistema LIDAR aerotransportado</a></li>
<li class="chapter" data-level="1.4" data-path="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html"><a href="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html#el-dato-lidar"><i class="fa fa-check"></i><b>1.4</b> El dato LiDAR</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html"><a href="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html#capacidad-multirretono"><i class="fa fa-check"></i><b>1.4.1</b> Capacidad multirretono</a></li>
<li class="chapter" data-level="1.4.2" data-path="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html"><a href="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html#el-fichero-.laslaz"><i class="fa fa-check"></i><b>1.4.2</b> El fichero <code>*.las/laz</code></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html"><a href="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html#la-clasificación-de-los-retornos"><i class="fa fa-check"></i><b>1.5</b> La clasificación de los retornos</a></li>
<li class="chapter" data-level="1.6" data-path="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html"><a href="la-tecnología-lidar-y-su-aplicación-al-medio-forestal.html#estimación-de-las-variables-de-la-masa-forestal"><i class="fa fa-check"></i><b>1.6</b> Estimación de las variables de la masa forestal</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html"><i class="fa fa-check"></i><b>2</b> Introducción al lenguaje R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#introducción-al-lenguaje-r-1"><i class="fa fa-check"></i><b>2.1</b> Introducción al lenguaje R</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#que-es-r"><i class="fa fa-check"></i><b>2.1.1</b> ¿Que es R?</a></li>
<li class="chapter" data-level="2.1.2" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#por-qué-usar-r"><i class="fa fa-check"></i><b>2.1.2</b> ¿Por qué usar R?</a></li>
<li class="chapter" data-level="2.1.3" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#recursos-sobre-r"><i class="fa fa-check"></i><b>2.1.3</b> Recursos sobre R</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#instalación-de-r-rstudio-y-librerias"><i class="fa fa-check"></i><b>2.2</b> Instalación de R, RStudio y librerias</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#instalación-de-r"><i class="fa fa-check"></i><b>2.2.1</b> Instalación de R</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#actualización-de-r"><i class="fa fa-check"></i><b>2.3</b> Actualización de R</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#el-sistema-r"><i class="fa fa-check"></i><b>2.3.1</b> El Sistema R</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#gestión-de-directorios-archivos-y-versiones"><i class="fa fa-check"></i><b>2.4</b> Gestión de directorios, archivos y versiones</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#gestión-de-directorios"><i class="fa fa-check"></i><b>2.4.1</b> Gestión de directorios</a></li>
<li class="chapter" data-level="2.4.2" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#manejo-de-archivos"><i class="fa fa-check"></i><b>2.4.2</b> Manejo de archivos</a></li>
<li class="chapter" data-level="2.4.3" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#carga-de-datos-usando-el-buscador"><i class="fa fa-check"></i><b>2.4.3</b> Carga de datos usando el buscador</a></li>
<li class="chapter" data-level="2.4.4" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#limpieza-de-la-memoria-en-r"><i class="fa fa-check"></i><b>2.4.4</b> Limpieza de la memoria en <code>R</code></a></li>
<li class="chapter" data-level="2.4.5" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#control-de-versiones"><i class="fa fa-check"></i><b>2.4.5</b> Control de versiones</a></li>
<li class="chapter" data-level="2.4.6" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#buenas-prácticas-en-la-gestión-de-un-proyecto"><i class="fa fa-check"></i><b>2.4.6</b> Buenas prácticas en la gestión de un proyecto</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#manejo-de-objetos-en-r"><i class="fa fa-check"></i><b>2.5</b> Manejo de objetos en R</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#r-como-calculadora"><i class="fa fa-check"></i><b>2.5.1</b> R como calculadora</a></li>
<li class="chapter" data-level="2.5.2" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#manejo-de-variables"><i class="fa fa-check"></i><b>2.5.2</b> Manejo de variables</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#manejo-de-datos-en-r"><i class="fa fa-check"></i><b>2.6</b> Manejo de datos en R</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#tipos-de-datos"><i class="fa fa-check"></i><b>2.6.1</b> Tipos de datos</a></li>
<li class="chapter" data-level="2.6.2" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#valores-perdidos-y-nulos"><i class="fa fa-check"></i><b>2.6.2</b> Valores perdidos y nulos</a></li>
<li class="chapter" data-level="2.6.3" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#registros-duplicados"><i class="fa fa-check"></i><b>2.6.3</b> Registros duplicados</a></li>
<li class="chapter" data-level="2.6.4" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#reescalado"><i class="fa fa-check"></i><b>2.6.4</b> Reescalado</a></li>
<li class="chapter" data-level="2.6.5" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#normalizado-y-estandarizado"><i class="fa fa-check"></i><b>2.6.5</b> Normalizado y estandarizado</a></li>
<li class="chapter" data-level="2.6.6" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#categorizar-los-datos"><i class="fa fa-check"></i><b>2.6.6</b> Categorizar los datos</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#profundizando-en-el-data.frame"><i class="fa fa-check"></i><b>2.7</b> Profundizando en el <code>data.frame</code></a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#introducción-1"><i class="fa fa-check"></i><b>2.7.1</b> Introducción</a></li>
<li class="chapter" data-level="2.7.2" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#visualizar-tablas"><i class="fa fa-check"></i><b>2.7.2</b> Visualizar tablas</a></li>
<li class="chapter" data-level="2.7.3" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#extracción-de-datos-en-nuevos-data.frame"><i class="fa fa-check"></i><b>2.7.3</b> Extracción de datos en nuevos <code>data.frame</code></a></li>
<li class="chapter" data-level="2.7.4" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#gestionar-los-data.frame"><i class="fa fa-check"></i><b>2.7.4</b> Gestionar los <code>data.frame</code></a></li>
<li class="chapter" data-level="2.7.5" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#la-libreria-dplyr"><i class="fa fa-check"></i><b>2.7.5</b> La libreria <code>dplyr</code></a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#estructuras-de-control"><i class="fa fa-check"></i><b>2.8</b> Estructuras de control</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#introducción-2"><i class="fa fa-check"></i><b>2.8.1</b> Introducción</a></li>
<li class="chapter" data-level="2.8.2" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#while"><i class="fa fa-check"></i><b>2.8.2</b> <code>while</code></a></li>
<li class="chapter" data-level="2.8.3" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#for"><i class="fa fa-check"></i><b>2.8.3</b> <code>for</code></a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#los-gráficos-en-r"><i class="fa fa-check"></i><b>2.9</b> Los gráficos en R</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#ggplot2"><i class="fa fa-check"></i><b>2.9.1</b> ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#las-funciones-en-r"><i class="fa fa-check"></i><b>2.10</b> Las funciones en R</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#estructura-de-una-función"><i class="fa fa-check"></i><b>2.10.1</b> Estructura de una función</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#publicación-de-resultados"><i class="fa fa-check"></i><b>2.11</b> Publicación de resultados</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="introducción-al-lenguaje-r.html"><a href="introducción-al-lenguaje-r.html#la-escritura-con-markdown"><i class="fa fa-check"></i><b>2.11.1</b> La escritura con Markdown</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-y-lidar.html"><a href="r-y-lidar.html"><i class="fa fa-check"></i><b>3</b> R y LiDAR</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-y-lidar.html"><a href="r-y-lidar.html#preparación-del-entorno-de-trabajo"><i class="fa fa-check"></i><b>3.1</b> Preparación del entorno de trabajo</a></li>
<li class="chapter" data-level="3.2" data-path="r-y-lidar.html"><a href="r-y-lidar.html#limpieza-y-filtrado-de-los-datos-lidar"><i class="fa fa-check"></i><b>3.2</b> Limpieza y filtrado de los datos LiDAR</a></li>
<li class="chapter" data-level="3.3" data-path="r-y-lidar.html"><a href="r-y-lidar.html#clasificación-de-los-retornos"><i class="fa fa-check"></i><b>3.3</b> Clasificación de los retornos</a></li>
<li class="chapter" data-level="3.4" data-path="r-y-lidar.html"><a href="r-y-lidar.html#generación-de-los-modelos-digitales-del-terreno-y-de-las-elevaciones"><i class="fa fa-check"></i><b>3.4</b> Generación de los modelos digitales del terreno y de las elevaciones</a></li>
<li class="chapter" data-level="3.5" data-path="r-y-lidar.html"><a href="r-y-lidar.html#normalización"><i class="fa fa-check"></i><b>3.5</b> Normalización</a></li>
<li class="chapter" data-level="3.6" data-path="r-y-lidar.html"><a href="r-y-lidar.html#recorte-de-las-parcelas-de-campo-en-la-nube-de-puntos-lidar-y-cálculo-de-los-estadísticos-descriptivos"><i class="fa fa-check"></i><b>3.6</b> Recorte de las parcelas de campo en la nube de puntos LiDAR y cálculo de los estadísticos descriptivos</a></li>
<li class="chapter" data-level="3.7" data-path="r-y-lidar.html"><a href="r-y-lidar.html#ajuste-de-los-modelos-de-transición-por-estrato"><i class="fa fa-check"></i><b>3.7</b> Ajuste de los modelos de transición por estrato</a></li>
<li class="chapter" data-level="3.8" data-path="r-y-lidar.html"><a href="r-y-lidar.html#cálculo-de-los-estadísticos-descriptivos-lidar-en-todo-el-monte"><i class="fa fa-check"></i><b>3.8</b> Cálculo de los estadísticos descriptivos LiDAR en todo el monte</a></li>
<li class="chapter" data-level="3.9" data-path="r-y-lidar.html"><a href="r-y-lidar.html#aplicación-de-los-modelos-de-transición"><i class="fa fa-check"></i><b>3.9</b> Aplicación de los modelos de transición</a></li>
<li class="chapter" data-level="3.10" data-path="r-y-lidar.html"><a href="r-y-lidar.html#segmentación-de-árboles"><i class="fa fa-check"></i><b>3.10</b> Segmentación de árboles</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>4</b> Referencias</a></li>
<li class="divider"></li>
Ir a <a href="http://www.jsevilla.es/">JSEVILLA</a>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tratamiento de datos LiDAR forestales mediante R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r-y-lidar" class="section level1" number="3">
<h1><span class="header-section-number">3</span> R y LiDAR</h1>
<div id="preparación-del-entorno-de-trabajo" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Preparación del entorno de trabajo</h2>
<p>A lo largo de este manual haremos uso de varias librerías de <code>R</code> relativas al tratamiento de datos espacial, con especial atención a la librería <code>lidR</code> que sera la herramienta de cabecera. Dado que muchas puede ser que ya estén instaladas en tu computadora, usaremos un pequeño código que permite distinguir si ya lo está y si no es así, procede a instalarla de forma transparente para ti.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="r-y-lidar.html#cb1-1" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lidR&quot;</span>, <span class="st">&quot;sf&quot;</span>, <span class="st">&quot;sp&quot;</span>, <span class="st">&quot;rgdal&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;skimr&quot;</span>, <span class="st">&quot;lmtest&quot;</span>, <span class="st">&quot;raster&quot;</span>)</span>
<span id="cb1-2"><a href="r-y-lidar.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="r-y-lidar.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalamos los paquetes que no estén instalados</span></span>
<span id="cb1-4"><a href="r-y-lidar.html#cb1-4" aria-hidden="true" tabindex="-1"></a>installed_packages <span class="ot">&lt;-</span> packages <span class="sc">%in%</span> <span class="fu">rownames</span>(<span class="fu">installed.packages</span>())</span>
<span id="cb1-5"><a href="r-y-lidar.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(installed_packages <span class="sc">==</span> <span class="cn">FALSE</span>)) {</span>
<span id="cb1-6"><a href="r-y-lidar.html#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(packages[<span class="sc">!</span>installed_packages])</span>
<span id="cb1-7"><a href="r-y-lidar.html#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-8"><a href="r-y-lidar.html#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="r-y-lidar.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos los paquetes</span></span>
<span id="cb1-10"><a href="r-y-lidar.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## Warning: package &#39;lidR&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;raster&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;sp&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;sf&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;rgdal&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;dplyr&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;skimr&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;lmtest&#39; was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package &#39;zoo&#39; was built under R version 4.0.5</code></pre>
<p>A continuación crearemos una estructura de carpetas, predefinida, de forma que el trabajo sea lo más sistemático posible. Con ellas creadas, fijamos el directorio de trabajo y procedemos a descargar y descomprimir los datos LiDAR, vectoriales, raster y tabulares de los que disponemos del trabajo de campo y del vuelo LiDAR:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="r-y-lidar.html#cb11-1" aria-hidden="true" tabindex="-1"></a>dir<span class="ot">&lt;-</span><span class="st">&quot;c:/rlidar&quot;</span></span>
<span id="cb11-2"><a href="r-y-lidar.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(dir)</span>
<span id="cb11-3"><a href="r-y-lidar.html#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="r-y-lidar.html#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="r-y-lidar.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/&quot;</span>), <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a href="r-y-lidar.html#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/&quot;</span>))</span>
<span id="cb11-7"><a href="r-y-lidar.html#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="r-y-lidar.html#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="r-y-lidar.html#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">dir.exists</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/data/&quot;</span>))){</span>
<span id="cb11-10"><a href="r-y-lidar.html#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;ya existe el directorio ./data&quot;</span>)</span>
<span id="cb11-11"><a href="r-y-lidar.html#cb11-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb11-12"><a href="r-y-lidar.html#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="fu">dir.create</span>(<span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">&quot;/data/&quot;</span>)))</span>
<span id="cb11-13"><a href="r-y-lidar.html#cb11-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-14"><a href="r-y-lidar.html#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="r-y-lidar.html#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="r-y-lidar.html#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://raw.githubusercontent.com/juliomsevilla/rlidar/main/data/lidar_data.zip&quot;</span>,</span>
<span id="cb11-17"><a href="r-y-lidar.html#cb11-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> <span class="fu">paste0</span>(dir, <span class="st">&quot;/temp/lidar_data.zip&quot;</span>), </span>
<span id="cb11-18"><a href="r-y-lidar.html#cb11-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;curl&quot;</span>, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-19"><a href="r-y-lidar.html#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="r-y-lidar.html#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="fu">paste0</span>(dir, <span class="st">&quot;/temp/lidar_data.zip&quot;</span>), <span class="at">exdir =</span> <span class="st">&quot;./temp&quot;</span>)</span></code></pre></div>
</div>
<div id="limpieza-y-filtrado-de-los-datos-lidar" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Limpieza y filtrado de los datos LiDAR</h2>
<p>Para comenzar, si analizamos los <em>tiles</em> LiDAR, estos no vienen proyectados, por lo que procederemos a ello. Para hacerlo de forma rápida y automática usaremos una estructura de control <code>for</code> de forma que si previamente hemos listado todos los ficheros LiDAR a reproyectar, abriremos cada uno de ellos con <code>readLAS()</code>se les asigne la proyección que realmente tienen y se guarden con ella en la carpeta <code>temp</code> con <code>writeLAS</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="r-y-lidar.html#cb12-1" aria-hidden="true" tabindex="-1"></a>tiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste0</span>(dir, <span class="st">&quot;/temp/tiles/&quot;</span>), <span class="at">full.names=</span><span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="r-y-lidar.html#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="r-y-lidar.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/tiles_ref/&quot;</span>))</span>
<span id="cb12-4"><a href="r-y-lidar.html#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="r-y-lidar.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (file <span class="cf">in</span> tiles) {</span>
<span id="cb12-6"><a href="r-y-lidar.html#cb12-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-7"><a href="r-y-lidar.html#cb12-7" aria-hidden="true" tabindex="-1"></a>  las<span class="ot">&lt;-</span><span class="fu">readLAS</span>(file)</span>
<span id="cb12-8"><a href="r-y-lidar.html#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">epsg</span>(las) <span class="ot">&lt;-</span> <span class="dv">25830</span></span>
<span id="cb12-9"><a href="r-y-lidar.html#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeLAS</span>(las, <span class="fu">paste0</span>(dir, <span class="st">&quot;/temp/tiles_ref/&quot;</span>, <span class="fu">basename</span>(file)))</span>
<span id="cb12-10"><a href="r-y-lidar.html#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(las)</span>
<span id="cb12-11"><a href="r-y-lidar.html#cb12-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees

## Warning: Invalid data: ScanAngleRank greater than 90 degrees

## Warning: Invalid data: ScanAngleRank greater than 90 degrees

## Warning: Invalid data: ScanAngleRank greater than 90 degrees

## Warning: Invalid data: ScanAngleRank greater than 90 degrees

## Warning: Invalid data: ScanAngleRank greater than 90 degrees

## Warning: Invalid data: ScanAngleRank greater than 90 degrees

## Warning: Invalid data: ScanAngleRank greater than 90 degrees

## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<p>La librería <code>lidR</code>,para gestionar grandes cantidades de datos, usa un objeto <code>LAScatalog</code> de modo que el procesamiento de cada tesela LiDAR se hace de forma ordenada. El objeto <code>LAScatalog</code> en realidad contiene las referencias geográficas y cabeceras de los ficheros LiDAR que permite ubicar espacialmente y posteriormente aplicar la mayoría de las funciones de <code>lidR</code> como si se tratara de una sola nube de puntos cargada en la memoria de la computadora.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="r-y-lidar.html#cb14-1" aria-hidden="true" tabindex="-1"></a>ctg <span class="ot">&lt;-</span> <span class="fu">readLAScatalog</span>(<span class="fu">paste0</span>(dir, <span class="st">&quot;/temp/tiles_ref/&quot;</span>))</span>
<span id="cb14-2"><a href="r-y-lidar.html#cb14-2" aria-hidden="true" tabindex="-1"></a>ctg</span></code></pre></div>
<pre><code>## class       : LAScatalog (v1.2 format 3)
## extent      : 599076.4, 600271.8, 4734589, 4735338 (xmin, xmax, ymin, ymax)
## coord. ref. : ETRS89 / UTM zone 30N 
## area        : 442139.4 m²
## points      : 3.56million points
## density     : 8.1 points/m²
## num. files  : 9</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="r-y-lidar.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ctg)</span></code></pre></div>
<p><img src="_main_files/figure-html/catalogo-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Una vez creado el objeto <code>LAScatalog</code> procedemos a su validación y estudio con el comando <code>las_check</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="r-y-lidar.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">las_check</span>(ctg)</span></code></pre></div>
<pre><code>## 
##  Checking headers consistency
##   - Checking file version consistency...[0;32m &lt;U+2713&gt;[0m
##   - Checking scale consistency...[0;32m &lt;U+2713&gt;[0m
##   - Checking offset consistency...[0;32m &lt;U+2713&gt;[0m
##   - Checking point type consistency...[0;32m &lt;U+2713&gt;[0m
##   - Checking VLR consistency...[0;32m &lt;U+2713&gt;[0m
##   - Checking CRS consistency...[0;32m &lt;U+2713&gt;[0m
##  Checking the headers
##   - Checking scale factor validity...[0;32m &lt;U+2713&gt;[0m
##   - Checking Point Data Format ID validity...[0;32m &lt;U+2713&gt;[0m
##  Checking preprocessing already done 
##   - Checking negative outliers...[0;32m &lt;U+2713&gt;[0m
##   - Checking normalization...[0;31m no[0m
##  Checking the geometry
##   - Checking overlapping tiles...[0;32m &lt;U+2713&gt;[0m
##   - Checking point indexation...[0;31m no[0m</code></pre>
</div>
<div id="clasificación-de-los-retornos" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Clasificación de los retornos</h2>
<p>La clasificación de los puntos terrestres es un paso importante en el procesamiento de datos de nubes de puntos. La distinción entre puntos de suelo y no permite crear un modelo digital del terreno que posteriormente nos permita normalizar los puntos LiDAR, esto es, pasar de altitudes respecto a un determinado nivel de referencia a alturas o cotas respecto a un cero, que, evidentemente, si hablamos de árboles es lo que más nos puede interesar.</p>
<p>Los datos del ejemplo ya vienen clasificados, pero los volveremos a clasificar para demostrar como lo efectúa la librería <code>lidR</code>. En concreto, esta librería usa dos formas de clasificación: <code>pmf()</code> <span class="citation">(<a href="#ref-R-Zhang2003" role="doc-biblioref">K. Zhang et al. 2003</a>)</span> y <code>csf()</code> <span class="citation">(<a href="#ref-R-Zhang2016" role="doc-biblioref">W. Zhang et al. 2016</a>)</span>, cada uno con parámetros característicos que podremos modificar y es uno de los pasos más críticos y complejos del proceso.</p>
<p>Una vez que los puntos son clasificados, se asigna el valor de 2 al campo de clasificación del retorno, siguiendo las prescripciones que estandariza la Sociedad Americana de Fotogrametría y Teledetección (<a href="https://www.asprs.org/">ASPRS</a>) para los formatos LAS 1.1, 1.2, 1.3 y 1.4.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="r-y-lidar.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_filter</span>(ctg) <span class="ot">&lt;-</span> <span class="st">&quot;-drop-scan-angle &#39;&gt;=91&#39;&quot;</span></span>
<span id="cb19-2"><a href="r-y-lidar.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/tiles_class/&quot;</span>))</span>
<span id="cb19-3"><a href="r-y-lidar.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(ctg) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/tiles_class/&quot;</span>, <span class="st">&quot;{*}_class&quot;</span>)</span>
<span id="cb19-4"><a href="r-y-lidar.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="r-y-lidar.html#cb19-5" aria-hidden="true" tabindex="-1"></a>classified_ctg <span class="ot">&lt;-</span> <span class="fu">classify_ground</span>(ctg, <span class="fu">csf</span>())</span></code></pre></div>
</div>
<div id="generación-de-los-modelos-digitales-del-terreno-y-de-las-elevaciones" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Generación de los modelos digitales del terreno y de las elevaciones</h2>
<p>Con la nube de puntos clasificada, al menos en puntos de suelo y no, calcularemos el modelo digital del terreno que posteriormente nos permita normalizar la nube de puntos.</p>
<p>La librería <code>lidR</code>permite tres métodos de interpolación de los puntos del suelo con el comando <code>grid_terrain</code>: <code>tin</code> (red de triángulos irregulares), <code>knnidw</code> (distancia inversa ponderada) y <code>kriging</code>, de menor a mayor complejidad y uso de recursos en este orden.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>En nuestro caso, usamos <code>kriging</code> (<code>lidR</code> usa la librería <code>gstat</code> por si deseamos saber más sobre este método de interpolación probabilístico) porque los otros métodos no se pueden usar debido a los pocos puntos de suelo que tenemos. Si usamos <code>algorithm =tin()</code> por ejemplo, observaremos a un error del tipo <code>convexhull</code> debido a que los puntos de suelo con los que contamos en muchos casos están muy separados físicamente.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="r-y-lidar.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/mdt/&quot;</span>))</span>
<span id="cb20-2"><a href="r-y-lidar.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(classified_ctg) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/mdt/&quot;</span>, <span class="st">&quot;{*}_dtm&quot;</span>)</span>
<span id="cb20-3"><a href="r-y-lidar.html#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="r-y-lidar.html#cb20-4" aria-hidden="true" tabindex="-1"></a>dtm <span class="ot">&lt;-</span> <span class="fu">grid_terrain</span>(classified_ctg, <span class="dv">1</span>,  <span class="at">algorithm =</span> <span class="fu">kriging</span>(<span class="at">k =</span> <span class="dv">40</span>), <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning: There were 12 degenerated ground points. Some X Y coordinates were
## repeated but with different Z coordinates. min Z were retained.</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<pre><code>## Chunk 1 of 9 (11.1%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: There were 56 degenerated ground points. Some X Y coordinates were
## repeated but with different Z coordinates. min Z were retained.</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<pre><code>## Chunk 2 of 9 (22.2%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: There were 38 degenerated ground points. Some X Y coordinates were
## repeated but with different Z coordinates. min Z were retained.</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<pre><code>## Chunk 3 of 9 (33.3%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: There were 79 degenerated ground points. Some X Y coordinates were
## repeated but with different Z coordinates. min Z were retained.</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<pre><code>## Chunk 4 of 9 (44.4%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: There were 1 degenerated ground points. Some X Y Z coordinates were
## repeated. They were removed.</code></pre>
<pre><code>## Warning: There were 90 degenerated ground points. Some X Y coordinates were
## repeated but with different Z coordinates. min Z were retained.</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<pre><code>## Chunk 5 of 9 (55.6%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: There were 21 degenerated ground points. Some X Y coordinates were
## repeated but with different Z coordinates. min Z were retained.</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<pre><code>## Chunk 6 of 9 (66.7%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: There were 22 degenerated ground points. Some X Y coordinates were
## repeated but with different Z coordinates. min Z were retained.</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<pre><code>## Chunk 7 of 9 (77.8%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: There were 9 degenerated ground points. Some X Y coordinates were
## repeated but with different Z coordinates. min Z were retained.</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<pre><code>## Chunk 8 of 9 (88.9%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: There were 6 degenerated ground points. Some X Y coordinates were
## repeated but with different Z coordinates. min Z were retained.</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<pre><code>## Chunk 9 of 9 (100%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition

## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<p><img src="_main_files/figure-html/mdt-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="r-y-lidar.html#cb59-1" aria-hidden="true" tabindex="-1"></a>dtm</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 751, 1196, 898196  (nrow, ncol, ncell)
## resolution : 1, 1  (x, y)
## extent     : 599076, 600272, 4734588, 4735339  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs 
## source     : grid_terrain.vrt 
## names      : tile_1_dtm 
## values     : 506.2, 715.4  (min, max)</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="r-y-lidar.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dtm)</span></code></pre></div>
<p><img src="_main_files/figure-html/mdt-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="normalización" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Normalización</h2>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="r-y-lidar.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalizamos los datos y creamos el modelo digital de elevaciones normalizado</span></span>
<span id="cb62-2"><a href="r-y-lidar.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/tiles_norm/&quot;</span>))</span>
<span id="cb62-3"><a href="r-y-lidar.html#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(classified_ctg) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/tiles_norm/&quot;</span>, <span class="st">&quot;{*}_norm&quot;</span>)</span>
<span id="cb62-4"><a href="r-y-lidar.html#cb62-4" aria-hidden="true" tabindex="-1"></a>ctg_norm <span class="ot">&lt;-</span> <span class="fu">normalize_height</span>(classified_ctg, dtm)</span></code></pre></div>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 1 of 9 (11.1%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 2 of 9 (22.2%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 3 of 9 (33.3%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 4 of 9 (44.4%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 5 of 9 (55.6%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 6 of 9 (66.7%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 7 of 9 (77.8%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 8 of 9 (88.9%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<p><img src="_main_files/figure-html/normalizacion-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## Chunk 9 of 9 (100%): state &lt;U+26A0&gt;</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="r-y-lidar.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">las_check</span>(ctg_norm)</span></code></pre></div>
<pre><code>## 
##  Checking headers consistency
##   - Checking file version consistency...[0;32m &lt;U+2713&gt;[0m
##   - Checking scale consistency...[0;32m &lt;U+2713&gt;[0m
##   - Checking offset consistency...[0;32m &lt;U+2713&gt;[0m
##   - Checking point type consistency...[0;32m &lt;U+2713&gt;[0m
##   - Checking VLR consistency...[0;32m &lt;U+2713&gt;[0m
##   - Checking CRS consistency...[0;32m &lt;U+2713&gt;[0m
##  Checking the headers
##   - Checking scale factor validity...[0;32m &lt;U+2713&gt;[0m
##   - Checking Point Data Format ID validity...[0;32m &lt;U+2713&gt;[0m
##  Checking preprocessing already done 
##   - Checking negative outliers...
##  [1;33m   &lt;U+26A0&gt; 9 file(s) with points below 0[0m
##   - Checking normalization...[0;31m no[0m
##  Checking the geometry
##   - Checking overlapping tiles...[0;32m &lt;U+2713&gt;[0m
##   - Checking point indexation...[0;31m no[0m</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="r-y-lidar.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/mds/&quot;</span>))</span>
<span id="cb83-2"><a href="r-y-lidar.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_filter</span>(ctg_norm) <span class="ot">&lt;-</span> <span class="st">&quot;-drop_z_below 0&quot;</span> <span class="co"># Ignoramos los puntos con cota por debajo de cero</span></span>
<span id="cb83-3"><a href="r-y-lidar.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(ctg_norm) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/mds/&quot;</span>, <span class="st">&quot;{*}_mds&quot;</span>)</span>
<span id="cb83-4"><a href="r-y-lidar.html#cb83-4" aria-hidden="true" tabindex="-1"></a>mds <span class="ot">&lt;-</span> <span class="fu">grid_canopy</span>(ctg_norm, <span class="dv">1</span>, <span class="fu">pitfree</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">subcircle =</span> <span class="fl">0.2</span>))</span></code></pre></div>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<pre><code>## Chunk 1 of 9 (11.1%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84 =
## OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum European Terrestrial
## Reference System 1989 in Proj4 definition</code></pre>
<pre><code>## Chunk 2 of 9 (22.2%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84 =
## OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum European Terrestrial
## Reference System 1989 in Proj4 definition</code></pre>
<pre><code>## Chunk 3 of 9 (33.3%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84 =
## OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum European Terrestrial
## Reference System 1989 in Proj4 definition</code></pre>
<pre><code>## Chunk 4 of 9 (44.4%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84 =
## OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum European Terrestrial
## Reference System 1989 in Proj4 definition</code></pre>
<pre><code>## Chunk 5 of 9 (55.6%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84 =
## OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum European Terrestrial
## Reference System 1989 in Proj4 definition</code></pre>
<pre><code>## Chunk 6 of 9 (66.7%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84 =
## OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum European Terrestrial
## Reference System 1989 in Proj4 definition</code></pre>
<pre><code>## Chunk 7 of 9 (77.8%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84 =
## OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum European Terrestrial
## Reference System 1989 in Proj4 definition</code></pre>
<pre><code>## Chunk 8 of 9 (88.9%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84
## = OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum
## European_Terrestrial_Reference_System_1989 in Proj4 definition: +proj=utm
## +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs

## Warning in getProjectionRef(x, OVERRIDE_PROJ_DATUM_WITH_TOWGS84 =
## OVERRIDE_PROJ_DATUM_WITH_TOWGS84, : Discarded datum European Terrestrial
## Reference System 1989 in Proj4 definition</code></pre>
<pre><code>## Chunk 9 of 9 (100%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition

## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<p><img src="_main_files/figure-html/mde-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="r-y-lidar.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mds)</span></code></pre></div>
<p><img src="_main_files/figure-html/mde-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="recorte-de-las-parcelas-de-campo-en-la-nube-de-puntos-lidar-y-cálculo-de-los-estadísticos-descriptivos" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Recorte de las parcelas de campo en la nube de puntos LiDAR y cálculo de los estadísticos descriptivos</h2>
<p>Para comenzar cargaremos los puntos de muestreo efectuados en campo:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="r-y-lidar.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_filter</span>(ctg_norm) <span class="ot">&lt;-</span> <span class="st">&quot;-drop_z_below 0&quot;</span></span>
<span id="cb105-2"><a href="r-y-lidar.html#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="r-y-lidar.html#cb105-3" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;./temp/parc.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `parc&#39; from data source `C:\rlidar\temp\parc.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 29 features and 3 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 599121.6 ymin: 4734703 xmax: 600228.6 ymax: 4735279
## Projected CRS: ETRS89 / UTM zone 30N</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="r-y-lidar.html#cb107-1" aria-hidden="true" tabindex="-1"></a>rodal <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;./temp/rodal.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `rodal&#39; from data source `C:\rlidar\temp\rodal.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 1 feature and 1 field
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 599076.4 ymin: 4734589 xmax: 600271.9 ymax: 4735338
## Projected CRS: ETRS89 / UTM zone 30N</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="r-y-lidar.html#cb109-1" aria-hidden="true" tabindex="-1"></a>plots</span></code></pre></div>
<pre><code>## Simple feature collection with 29 features and 3 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 599121.6 ymin: 4734703 xmax: 600228.6 ymax: 4735279
## Projected CRS: ETRS89 / UTM zone 30N
## First 10 features:
##    id        X       Y                 geometry
## 1   1 599121.6 4735073 POINT (599121.6 4735073)
## 2   2 599249.4 4734787 POINT (599249.4 4734787)
## 3   3 599820.8 4735038 POINT (599820.8 4735038)
## 4   4 600038.5 4735137 POINT (600038.5 4735137)
## 5   5 599709.0 4735068   POINT (599709 4735068)
## 6   6 599263.3 4734872 POINT (599263.3 4734872)
## 7   7 599186.1 4734916 POINT (599186.1 4734916)
## 8   8 600118.0 4735187   POINT (600118 4735187)
## 9   9 599827.7 4735129 POINT (599827.7 4735129)
## 10 10 599478.4 4735048 POINT (599478.4 4735048)</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="r-y-lidar.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ctg)</span>
<span id="cb111-2"><a href="r-y-lidar.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plots, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in plot.sf(plots, add = TRUE, col = &quot;red&quot;): ignoring all but the first
## attribute</code></pre>
<p><img src="_main_files/figure-html/plots-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Para recortar estas parcelas de la nube de puntos podemos usar el comando <code>plot_metrics</code> (además guardaremos estos recortes para su uso futuro):</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="r-y-lidar.html#cb113-1" aria-hidden="true" tabindex="-1"></a>tiles_norm <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste0</span>(dir, <span class="st">&quot;/temp/tiles_norm/&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">&quot;(.*)norm.las$&quot;</span>)</span>
<span id="cb113-2"><a href="r-y-lidar.html#cb113-2" aria-hidden="true" tabindex="-1"></a>ctg_norm <span class="ot">&lt;-</span> <span class="fu">readLAScatalog</span>(tiles_norm)</span></code></pre></div>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="r-y-lidar.html#cb114-1" aria-hidden="true" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">plot_metrics</span>(ctg_norm, .stdmetrics_z, plots, <span class="at">radius =</span> <span class="dv">9</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotstats-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## Chunk 1 of 29 (3.4%): state &lt;U+2713&gt;
## Chunk 2 of 29 (6.9%): state &lt;U+2713&gt;
## Chunk 3 of 29 (10.3%): state &lt;U+2713&gt;
## Chunk 4 of 29 (13.8%): state &lt;U+2713&gt;
## Chunk 5 of 29 (17.2%): state &lt;U+2713&gt;
## Chunk 6 of 29 (20.7%): state &lt;U+2713&gt;
## Chunk 7 of 29 (24.1%): state &lt;U+2713&gt;
## Chunk 8 of 29 (27.6%): state &lt;U+2713&gt;
## Chunk 9 of 29 (31%): state &lt;U+2713&gt;
## Chunk 10 of 29 (34.5%): state &lt;U+2713&gt;
## Chunk 11 of 29 (37.9%): state &lt;U+2713&gt;
## Chunk 12 of 29 (41.4%): state &lt;U+2713&gt;
## Chunk 13 of 29 (44.8%): state &lt;U+2713&gt;
## Chunk 14 of 29 (48.3%): state &lt;U+2713&gt;
## Chunk 15 of 29 (51.7%): state &lt;U+2713&gt;
## Chunk 16 of 29 (55.2%): state &lt;U+2713&gt;
## Chunk 17 of 29 (58.6%): state &lt;U+2713&gt;
## Chunk 18 of 29 (62.1%): state &lt;U+2713&gt;
## Chunk 19 of 29 (65.5%): state &lt;U+2713&gt;
## Chunk 20 of 29 (69%): state &lt;U+2713&gt;
## Chunk 21 of 29 (72.4%): state &lt;U+2713&gt;
## Chunk 22 of 29 (75.9%): state &lt;U+2713&gt;
## Chunk 23 of 29 (79.3%): state &lt;U+2713&gt;
## Chunk 24 of 29 (82.8%): state &lt;U+2713&gt;
## Chunk 25 of 29 (86.2%): state &lt;U+2713&gt;
## Chunk 26 of 29 (89.7%): state &lt;U+2713&gt;
## Chunk 27 of 29 (93.1%): state &lt;U+2713&gt;
## Chunk 28 of 29 (96.6%): state &lt;U+2713&gt;
## Chunk 29 of 29 (100%): state &lt;U+2713&gt;</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="r-y-lidar.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stats)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 39 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 599121.6 ymin: 4734787 xmax: 600038.5 ymax: 4735137
## Projected CRS: ETRS89 / UTM zone 30N
##   id        X       Y  zmax    zmean      zsd       zskew    zkurt zentropy
## 1  1 599121.6 4735073 18.63 6.782145 6.378730  0.33117224 1.314945       NA
## 2  2 599249.4 4734787 16.56 6.864536 6.042658  0.02658273 1.194349       NA
## 3  3 599820.8 4735038 17.21 8.779583 5.659351 -0.37608105 1.428980       NA
## 4  4 600038.5 4735137 18.94 7.673064 6.676257 -0.02836398 1.193459       NA
## 5  5 599709.0 4735068 20.95 8.741759 7.279909 -0.04818947 1.180898       NA
## 6  6 599263.3 4734872 19.18 7.108978 6.759415  0.18350439 1.283135       NA
##   pzabovezmean pzabove2    zq5  zq10 zq15  zq20  zq25  zq30   zq35  zq40   zq45
## 1     43.23607 56.91550 -0.010  0.24 0.58 0.810 1.040 1.270 1.4900 1.822  2.160
## 2     51.38070 56.87248 -0.100 -0.01 0.06 0.184 0.575 0.920 1.2670 1.610  2.337
## 3     62.44883 78.34016  0.430  1.00 1.45 1.850 2.270 2.770 3.3510 9.764 10.620
## 4     51.83688 60.24982 -0.090 -0.01 0.06 0.160 0.360 0.640 1.1335 2.084  4.089
## 5     52.07767 60.03883  0.030  0.26 0.52 0.790 0.990 1.212 1.4800 2.016  5.799
## 6     47.22314 58.52777 -0.079 -0.03 0.00 0.020 0.050 0.150 0.7570 1.620  2.989
##     zq50    zq55   zq60   zq65  zq70  zq75   zq80   zq85   zq90    zq95
## 1  2.750  4.1480 11.030 12.094 12.83 13.43 14.148 14.740 15.490 16.2320
## 2  8.210 10.2430 11.380 11.963 12.36 12.74 13.170 13.660 14.178 14.8190
## 3 11.280 11.9100 12.336 12.760 13.09 13.58 14.040 14.491 14.954 15.4440
## 4 11.045 12.0255 12.540 12.930 13.40 13.90 14.418 15.000 15.609 16.2995
## 5 11.710 13.5500 14.294 14.941 15.39 15.73 16.120 16.499 16.940 17.9260
## 6  4.400 10.3220 11.740 12.530 13.12 13.83 14.406 15.057 16.000 16.8900
##     zpcum1   zpcum2   zpcum3   zpcum4   zpcum5   zpcum6   zpcum7   zpcum8
## 1 37.46998 51.24099 54.20336 54.36349 54.36349 58.40673 70.41633 85.10809
## 2 32.71454 39.92995 40.77058 41.75131 43.81786 47.60070 56.18214 77.93345
## 3 15.72303 33.66488 35.57766 35.57766 35.65417 42.00459 55.47054 76.58761
## 4 31.36929 36.97095 40.99585 41.49378 41.49378 45.10373 64.39834 84.56432
## 5 37.76876 41.37931 43.16430 45.07099 47.50507 49.08722 61.37931 87.54564
## 6 29.06931 37.62376 42.69307 43.24752 44.67327 50.65347 66.45545 84.07921
##     zpcum9                 geometry
## 1 97.59808 POINT (599121.6 4735073)
## 2 94.85114 POINT (599249.4 4734787)
## 3 95.25631 POINT (599820.8 4735038)
## 4 98.21577 POINT (600038.5 4735137)
## 5 98.58012   POINT (599709 4735068)
## 6 95.40594 POINT (599263.3 4734872)</code></pre>
</div>
<div id="ajuste-de-los-modelos-de-transición-por-estrato" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Ajuste de los modelos de transición por estrato</h2>
<p>Cargamos los datos medidos en las parcelas y se lo añadimos a los datos lidar. A continuación realizamos un análisis de correlación entre las variables de la nube de puntos y la futura variable dependiente (en este caso <code>vcc</code>).</p>
<p>Se define por correlación a la dirección y magnitud de la asociación entre dos variables cuantitativas, es decir que grado de relación hay entre ellas y si el aumento o disminución de una provoca el aumento o disminución de la otra.</p>
<p>El grado de correlación se mide mediante dos coeficientes: el coeficiente de correlación de Pearson y el coeficiente de correlación de Spearman, análogos en significado pero disimiles en su aplicación.</p>
<p>El coeficiente de correlación de Pearson es un coeficiente adimensional que va fluctúa entre -1 y +1, donde el primer valor indica la existencia de una asociación perfecta en sentido decreciente y el segundo en sentido creciente. Evidentemente, el valor cero, indica la inexistencia de relación.</p>
<p>El coeficiente de correlación de Pearson (a veces conocido como coeficiente de correlación a secas) es aplicable para variables cuantitativas que se relacionan de forma lineal. Por otro lado, el coeficiente de correlación de Spearman, es un evaluador de correlación, homólogo en su valor (-1 a +1) al de Pearson, pero con un carácter no paramétrico, lo que implica que la relación entre las variables puede no ser lineal, que no es tan exigente en la existencia de normalidad en la población y aplicable incluso a variables ordinales.</p>
<p>Centrándonos en el coeficiente de correlación de Pearson, dado que tratamos variables cuantitativas, empezamos cargando los datos de volumenes de las parcelas de muestreo, pasando posteriormente a unirlas a la tabla con los estadísticos descriptivos de la nube de puntos de esas parcelas obtenido anteriormente. Para finalizar mostramos las seis variables más relacionadas con la futura variable dependiente.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="r-y-lidar.html#cb118-1" aria-hidden="true" tabindex="-1"></a>vcc <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/muestreo.xlsx&quot;</span>))</span>
<span id="cb118-2"><a href="r-y-lidar.html#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(vcc)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##    parc   vcc
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1  61.9
## 2     2 131. 
## 3     3 218. 
## 4     4 193. 
## 5     5 210. 
## 6     6 123.</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="r-y-lidar.html#cb120-1" aria-hidden="true" tabindex="-1"></a>vcc <span class="ot">&lt;-</span> <span class="fu">left_join</span>(vcc, stats, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;parc&quot;</span> <span class="ot">=</span> <span class="st">&quot;id&quot;</span>))</span>
<span id="cb120-2"><a href="r-y-lidar.html#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="r-y-lidar.html#cb120-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> vcc <span class="sc">%&gt;%</span> </span>
<span id="cb120-4"><a href="r-y-lidar.html#cb120-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(parc, X, Y, geometry))<span class="sc">%&gt;%</span></span>
<span id="cb120-5"><a href="r-y-lidar.html#cb120-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cor</span>()<span class="sc">%&gt;%</span></span>
<span id="cb120-6"><a href="r-y-lidar.html#cb120-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb120-7"><a href="r-y-lidar.html#cb120-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_rownames</span>(<span class="at">var =</span> <span class="st">&quot;lidar_stat&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb120-8"><a href="r-y-lidar.html#cb120-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(lidar_stat<span class="sc">!=</span><span class="st">&#39;vcc&#39;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb120-9"><a href="r-y-lidar.html#cb120-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(vcc))</span></code></pre></div>
<pre><code>## Warning: `add_rownames()` was deprecated in dplyr 1.0.0.
## Please use `tibble::rownames_to_column()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="r-y-lidar.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 38
##   lidar_stat   vcc  zmax zmean   zsd  zskew  zkurt zentropy pzabovezmean
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;
## 1 zq90       0.887 0.947 0.804 0.915 -0.494 -0.355       NA        0.413
## 2 zq95       0.884 0.957 0.788 0.905 -0.455 -0.304       NA        0.380
## 3 zq85       0.882 0.933 0.829 0.920 -0.560 -0.435       NA        0.473
## # ... with 29 more variables: pzabove2 &lt;dbl&gt;, zq5 &lt;dbl&gt;, zq10 &lt;dbl&gt;,
## #   zq15 &lt;dbl&gt;, zq20 &lt;dbl&gt;, zq25 &lt;dbl&gt;, zq30 &lt;dbl&gt;, zq35 &lt;dbl&gt;, zq40 &lt;dbl&gt;,
## #   zq45 &lt;dbl&gt;, zq50 &lt;dbl&gt;, zq55 &lt;dbl&gt;, zq60 &lt;dbl&gt;, zq65 &lt;dbl&gt;, zq70 &lt;dbl&gt;,
## #   zq75 &lt;dbl&gt;, zq80 &lt;dbl&gt;, zq85 &lt;dbl&gt;, zq90 &lt;dbl&gt;, zq95 &lt;dbl&gt;, zpcum1 &lt;dbl&gt;,
## #   zpcum2 &lt;dbl&gt;, zpcum3 &lt;dbl&gt;, zpcum4 &lt;dbl&gt;, zpcum5 &lt;dbl&gt;, zpcum6 &lt;dbl&gt;,
## #   zpcum7 &lt;dbl&gt;, zpcum8 &lt;dbl&gt;, zpcum9 &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="r-y-lidar.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(df, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 38
##   lidar_stat    vcc   zmax  zmean    zsd  zskew  zkurt zentropy pzabovezmean
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;
## 1 zpcum6     -0.563 -0.562 -0.821 -0.617  0.912  0.646       NA       -0.888
## 2 zpcum7     -0.631 -0.433 -0.663 -0.635  0.657  0.612       NA       -0.585
## 3 zentropy   NA     NA     NA     NA     NA     NA            1       NA    
## # ... with 29 more variables: pzabove2 &lt;dbl&gt;, zq5 &lt;dbl&gt;, zq10 &lt;dbl&gt;,
## #   zq15 &lt;dbl&gt;, zq20 &lt;dbl&gt;, zq25 &lt;dbl&gt;, zq30 &lt;dbl&gt;, zq35 &lt;dbl&gt;, zq40 &lt;dbl&gt;,
## #   zq45 &lt;dbl&gt;, zq50 &lt;dbl&gt;, zq55 &lt;dbl&gt;, zq60 &lt;dbl&gt;, zq65 &lt;dbl&gt;, zq70 &lt;dbl&gt;,
## #   zq75 &lt;dbl&gt;, zq80 &lt;dbl&gt;, zq85 &lt;dbl&gt;, zq90 &lt;dbl&gt;, zq95 &lt;dbl&gt;, zpcum1 &lt;dbl&gt;,
## #   zpcum2 &lt;dbl&gt;, zpcum3 &lt;dbl&gt;, zpcum4 &lt;dbl&gt;, zpcum5 &lt;dbl&gt;, zpcum6 &lt;dbl&gt;,
## #   zpcum7 &lt;dbl&gt;, zpcum8 &lt;dbl&gt;, zpcum9 &lt;dbl&gt;</code></pre>
<p>Analizamos la variable dependiente</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="r-y-lidar.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(vcc<span class="sc">$</span>vcc)</span></code></pre></div>
<table>
<caption><span id="tab:normalidad">Table 3.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">vcc$vcc</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">29</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">data</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">322.4</td>
<td align="right">185.88</td>
<td align="right">44.69</td>
<td align="right">131.24</td>
<td align="right">368.46</td>
<td align="right">448.67</td>
<td align="right">756.03</td>
<td align="left">▇▆▇▆▁</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="r-y-lidar.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(vcc<span class="sc">$</span>vcc)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  vcc$vcc
## W = 0.94038, p-value = 0.1026</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="r-y-lidar.html#cb129-1" aria-hidden="true" tabindex="-1"></a>plotn <span class="ot">&lt;-</span> <span class="cf">function</span>(x,<span class="at">main=</span><span class="st">&quot;Histograma de frecuencias </span><span class="sc">\n</span><span class="st">y distribución normal&quot;</span>,</span>
<span id="cb129-2"><a href="r-y-lidar.html#cb129-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;Densidad&quot;</span>) {</span>
<span id="cb129-3"><a href="r-y-lidar.html#cb129-3" aria-hidden="true" tabindex="-1"></a>  min <span class="ot">&lt;-</span> <span class="fu">min</span>(x)</span>
<span id="cb129-4"><a href="r-y-lidar.html#cb129-4" aria-hidden="true" tabindex="-1"></a>  max <span class="ot">&lt;-</span> <span class="fu">max</span>(x)</span>
<span id="cb129-5"><a href="r-y-lidar.html#cb129-5" aria-hidden="true" tabindex="-1"></a>  media <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb129-6"><a href="r-y-lidar.html#cb129-6" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">sd</span>(x)</span>
<span id="cb129-7"><a href="r-y-lidar.html#cb129-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(x,<span class="at">freq=</span>F,<span class="at">main=</span>main,<span class="at">xlab=</span>xlab,<span class="at">ylab=</span>ylab)</span>
<span id="cb129-8"><a href="r-y-lidar.html#cb129-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">curve</span>(<span class="fu">dnorm</span>(x,media,dt), min, max,<span class="at">add =</span> T,<span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb129-9"><a href="r-y-lidar.html#cb129-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb129-10"><a href="r-y-lidar.html#cb129-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-11"><a href="r-y-lidar.html#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plotn</span>(<span class="fu">sqrt</span>(vcc<span class="sc">$</span>vcc))</span></code></pre></div>
<p><img src="_main_files/figure-html/normalidad-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Construimos el modelo</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="r-y-lidar.html#cb130-1" aria-hidden="true" tabindex="-1"></a>lm<span class="ot">&lt;-</span><span class="fu">lm</span>(vcc<span class="sc">~</span>zq90, <span class="at">data=</span>vcc)</span>
<span id="cb130-2"><a href="r-y-lidar.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = vcc ~ zq90, data = vcc)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -168.67  -37.87   13.77   46.15  152.18 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -950.723    128.282  -7.411 5.68e-08 ***
## zq90          75.685      7.565  10.005 1.41e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 87.25 on 27 degrees of freedom
## Multiple R-squared:  0.7876, Adjusted R-squared:  0.7797 
## F-statistic: 100.1 on 1 and 27 DF,  p-value: 1.406e-10</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="r-y-lidar.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vcc<span class="sc">$</span>vcc, <span class="fu">predict</span>(lm))</span>
<span id="cb132-2"><a href="r-y-lidar.html#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/linear_model-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="r-y-lidar.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) </span>
<span id="cb133-2"><a href="r-y-lidar.html#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm)</span></code></pre></div>
<p><img src="_main_files/figure-html/linear_model-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="r-y-lidar.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb134-2"><a href="r-y-lidar.html#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="r-y-lidar.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(lm))</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  residuals(lm)
## W = 0.93756, p-value = 0.08655</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="r-y-lidar.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(lm)</span></code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  lm
## BP = 0.66598, df = 1, p-value = 0.4145</code></pre>
</div>
<div id="cálculo-de-los-estadísticos-descriptivos-lidar-en-todo-el-monte" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Cálculo de los estadísticos descriptivos LiDAR en todo el monte</h2>
<p>Calculamos los estadísticos de los recintos. El radio de nuestras parcelas es de 9 metros, por lo que la superficie es de 254.469004941 m2 y esto implica una resolución de 15.95208</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="r-y-lidar.html#cb138-1" aria-hidden="true" tabindex="-1"></a>pixel <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(pi<span class="sc">*</span><span class="dv">9</span><span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb138-2"><a href="r-y-lidar.html#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="r-y-lidar.html#cb138-3" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">grid_metrics</span>(ctg_norm, .stdmetrics_z, <span class="at">res =</span> pixel)</span></code></pre></div>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Warning in min(x): ningún argumento finito para min; retornando Inf</code></pre>
<pre><code>## Warning in max(x): ningun argumento finito para max; retornando -Inf</code></pre>
<pre><code>## Warning in min(x, na.rm = TRUE): ningún argumento finito para min; retornando
## Inf</code></pre>
<pre><code>## Warning in max(x, na.rm = TRUE): ningun argumento finito para max; retornando
## -Inf</code></pre>
<pre><code>## Chunk 1 of 9 (11.1%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Warning in min(x, na.rm = TRUE): ningún argumento finito para min; retornando
## Inf</code></pre>
<pre><code>## Warning in max(x, na.rm = TRUE): ningun argumento finito para max; retornando
## -Inf</code></pre>
<pre><code>## Chunk 2 of 9 (22.2%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Warning in min(x): ningún argumento finito para min; retornando Inf</code></pre>
<pre><code>## Warning in max(x): ningun argumento finito para max; retornando -Inf</code></pre>
<pre><code>## Warning in min(x, na.rm = TRUE): ningún argumento finito para min; retornando
## Inf</code></pre>
<pre><code>## Warning in max(x, na.rm = TRUE): ningun argumento finito para max; retornando
## -Inf</code></pre>
<pre><code>## Chunk 3 of 9 (33.3%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Warning in min(x): ningún argumento finito para min; retornando Inf</code></pre>
<pre><code>## Warning in max(x): ningun argumento finito para max; retornando -Inf</code></pre>
<pre><code>## Warning in min(x, na.rm = TRUE): ningún argumento finito para min; retornando
## Inf</code></pre>
<pre><code>## Warning in max(x, na.rm = TRUE): ningun argumento finito para max; retornando
## -Inf</code></pre>
<pre><code>## Chunk 4 of 9 (44.4%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 5 of 9 (55.6%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 6 of 9 (66.7%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Chunk 7 of 9 (77.8%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Warning in min(x): ningún argumento finito para min; retornando Inf</code></pre>
<pre><code>## Warning in max(x): ningun argumento finito para max; retornando -Inf</code></pre>
<pre><code>## Warning in min(x, na.rm = TRUE): ningún argumento finito para min; retornando
## Inf</code></pre>
<pre><code>## Warning in max(x, na.rm = TRUE): ningun argumento finito para max; retornando
## -Inf</code></pre>
<pre><code>## Chunk 8 of 9 (88.9%): state &lt;U+26A0&gt;</code></pre>
<pre><code>## Warning: Invalid data: ScanAngleRank greater than 90 degrees</code></pre>
<pre><code>## Warning in min(x): ningún argumento finito para min; retornando Inf</code></pre>
<pre><code>## Warning in max(x): ningun argumento finito para max; retornando -Inf</code></pre>
<pre><code>## Warning in min(x, na.rm = TRUE): ningún argumento finito para min; retornando
## Inf</code></pre>
<pre><code>## Warning in max(x, na.rm = TRUE): ningun argumento finito para max; retornando
## -Inf</code></pre>
<p><img src="_main_files/figure-html/gridmetrics-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## Chunk 9 of 9 (100%): state &lt;U+26A0&gt;</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="r-y-lidar.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(metrics$zq90)</span></span></code></pre></div>
</div>
<div id="aplicación-de-los-modelos-de-transición" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> Aplicación de los modelos de transición</h2>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="r-y-lidar.html#cb180-1" aria-hidden="true" tabindex="-1"></a>vcc_pred <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">899.025+73.630</span><span class="sc">*</span>metrics<span class="sc">$</span>zq90</span>
<span id="cb180-2"><a href="r-y-lidar.html#cb180-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-3"><a href="r-y-lidar.html#cb180-3" aria-hidden="true" tabindex="-1"></a>orto<span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/ortoimagen.tif&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="r-y-lidar.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotRGB</span>(orto,<span class="at">r=</span><span class="dv">3</span>,<span class="at">g=</span><span class="dv">2</span>,<span class="at">b=</span><span class="dv">1</span>, <span class="at">stretch =</span> <span class="st">&quot;lin&quot;</span>)</span>
<span id="cb182-2"><a href="r-y-lidar.html#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="r-y-lidar.html#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="r-y-lidar.html#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vcc_pred,</span>
<span id="cb182-5"><a href="r-y-lidar.html#cb182-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="fu">rainbow</span>(<span class="dv">10</span>),</span>
<span id="cb182-6"><a href="r-y-lidar.html#cb182-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb182-7"><a href="r-y-lidar.html#cb182-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">add=</span>T,</span>
<span id="cb182-8"><a href="r-y-lidar.html#cb182-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">horizontal =</span> <span class="cn">TRUE</span>, </span>
<span id="cb182-9"><a href="r-y-lidar.html#cb182-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">legend.shrink=</span><span class="fl">0.75</span>,</span>
<span id="cb182-10"><a href="r-y-lidar.html#cb182-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">legend.args =</span> <span class="fu">list</span>(<span class="at">text=</span><span class="st">&#39;Vcc (dm^3)&#39;</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="dv">2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/ABA_results-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="r-y-lidar.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/vcc/&quot;</span>))</span>
<span id="cb183-2"><a href="r-y-lidar.html#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(vcc_pred, <span class="fu">paste</span>(dir, <span class="st">&quot;/temp/vcc/&quot;</span>, <span class="st">&quot;vcc_pred.tif&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">datatype=</span><span class="st">&#39;FLT4S&#39;</span>,<span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">bylayer =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning in showSRID(SRS_string, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj
## = prefer_proj): Discarded datum European Terrestrial Reference System 1989 in
## Proj4 definition</code></pre>
</div>
<div id="segmentación-de-árboles" class="section level2" number="3.10">
<h2><span class="header-section-number">3.10</span> Segmentación de árboles</h2>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="r-y-lidar.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(ctg_norm) <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb185-2"><a href="r-y-lidar.html#cb185-2" aria-hidden="true" tabindex="-1"></a>ttops <span class="ot">&lt;-</span> <span class="fu">find_trees</span>(ctg_norm, <span class="fu">lmf</span>(<span class="dv">4</span>), <span class="at">uniqueness =</span> <span class="st">&quot;bitmerge&quot;</span>)</span>
<span id="cb185-3"><a href="r-y-lidar.html#cb185-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-4"><a href="r-y-lidar.html#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(ctg_norm) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dir,<span class="st">&quot;/temp/&quot;</span>, <span class="st">&quot;{*}_segmented&quot;</span>)</span>
<span id="cb185-5"><a href="r-y-lidar.html#cb185-5" aria-hidden="true" tabindex="-1"></a>segm <span class="ot">&lt;-</span> <span class="fu">dalponte2016</span>(mdv, ttops)</span>
<span id="cb185-6"><a href="r-y-lidar.html#cb185-6" aria-hidden="true" tabindex="-1"></a>ctg_segmented <span class="ot">&lt;-</span> <span class="fu">segment_trees</span>(ctg_norm, segm)</span>
<span id="cb185-7"><a href="r-y-lidar.html#cb185-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-8"><a href="r-y-lidar.html#cb185-8" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(ctg_segmented) <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb185-9"><a href="r-y-lidar.html#cb185-9" aria-hidden="true" tabindex="-1"></a>lasplot <span class="ot">&lt;-</span> <span class="fu">clip_circle</span>(ctg_segmented, <span class="fl">599358.8984</span>,<span class="fl">4734939.2286</span>,  <span class="dv">50</span>)</span>
<span id="cb185-10"><a href="r-y-lidar.html#cb185-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(lasplot, color = &quot;treeID&quot;, bg = &quot;white&quot;, size = 4)</span></span></code></pre></div>

</div>
</div>
<h3> Referencias</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-R-Zhang2003" class="csl-entry">
Zhang, Keqi, Shu-Ching Chen, D. Whitman, Mei-Ling Shyu, Jianhua Yan, and Chengcui Zhang. 2003. <span>“A Progressive Morphological Filter for Removing Nonground Measurements from Airborne LIDAR Data.”</span> <em>IEEE Transactions on Geoscience and Remote Sensing</em> 41 (4): 872–82. <a href="https://doi.org/10.1109/TGRS.2003.810682">https://doi.org/10.1109/TGRS.2003.810682</a>.
</div>
<div id="ref-R-Zhang2016" class="csl-entry">
Zhang, Wuming, Jianbo Qi, Peng Wan, Hongtao Wang, Donghui Xie, Xiaoyan Wang, and Guangjian Yan. 2016. <span>“An Easy-to-Use Airborne LiDAR Data Filtering Method Based on Cloth Simulation.”</span> <em>Remote Sensing</em> 8 (6). <a href="https://doi.org/10.3390/rs8060501">https://doi.org/10.3390/rs8060501</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>El comando <code>classify_ground</code> no se limita solo a estos dos algoritmos, si no que la librería <code>lidR</code> permite añadir todo aquel algoritmo del que dispongamos fácilmente.<a href="r-y-lidar.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>El comando <code>grid_terrain</code> no se limita solo a estos tres algoritmos, si no que la librería <code>lidR</code> permite añadir todo aquel algoritmo del que dispongamos fácilmente.<a href="r-y-lidar.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introducción-al-lenguaje-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
